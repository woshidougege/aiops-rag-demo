# å¿«é€Ÿå¼€å§‹ï¼šä¼ä¸šæ–‡æ¡£å¯¼å…¥å‘é‡æ•°æ®åº“

## ğŸ¯ ç›®æ ‡
å°†ä¼ä¸šå†…éƒ¨æ–‡æ¡£ï¼ˆPDFã€Wordã€Markdown ç­‰ï¼‰å¯¼å…¥ Milvus å‘é‡æ•°æ®åº“ï¼Œå®ç°æ™ºèƒ½ RAG æ£€ç´¢ã€‚

---

## ğŸ“‹ å‰ç½®æ¡ä»¶

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd d:\aiops-rag-demo
.venv\Scripts\activate

# 2. å®‰è£…/æ›´æ–°ä¾èµ–
pip install -r requirements.txt
```

### 2. ç¡®è®¤ Milvus å¯ç”¨
```bash
# æµ‹è¯•è¿æ¥ï¼ˆä¼šåœ¨å¯¼å…¥æ—¶è‡ªåŠ¨æµ‹è¯•ï¼‰
python -c "from pymilvus import connections; connections.connect(host='192.168.1.65', port='19530'); print('âœ“ Milvus è¿æ¥æˆåŠŸ')"
```

### 3. é…ç½®æ£€æŸ¥
ç¡®è®¤ `aiops_demo/config.py` ä¸­çš„é…ç½®æ­£ç¡®ï¼š
```python
MILVUS_CONFIG = {
    "host": "192.168.1.65",
    "port": "19530",
    "collection_name": "aiops_knowledge_v1"
}

EMBEDDING_CONFIG = {
    "api_url": "https://api.siliconflow.cn/v1/embeddings",
    "api_key": "sk-...",  # ç¡®ä¿æœ‰æ•ˆ
    "model": "BAAI/bge-m3",
}
```

---

## ğŸš€ ä¸‰æ­¥å¿«é€Ÿå¯¼å…¥

### æ–¹å¼ Aï¼šå‘½ä»¤è¡Œå¯¼å…¥ï¼ˆæ¨èï¼‰

#### 1ï¸âƒ£ å¯¼å…¥å•ä¸ªæ–‡ä»¶
```bash
python aiops_demo\tools\document_importer.py --file "D:\ä¼ä¸šæ–‡æ¡£\MySQLè¿ç»´æ‰‹å†Œ.pdf" --collection "ä¼ä¸šçŸ¥è¯†åº“"
```

#### 2ï¸âƒ£ æ‰¹é‡å¯¼å…¥ç›®å½•
```bash
python aiops_demo\tools\document_importer.py --dir "D:\ä¼ä¸šæ–‡æ¡£" --collection "ä¼ä¸šçŸ¥è¯†åº“"
```

#### 3ï¸âƒ£ å¯¼å…¥ JSON çŸ¥è¯†åº“
```bash
python aiops_demo\tools\document_importer.py --json "aiops_demo\data\knowledge_base.json" --collection "aiops_knowledge_v1" --drop-old
```

---

### æ–¹å¼ Bï¼šPython è„šæœ¬å¯¼å…¥

åˆ›å»º `my_import.py`ï¼š
```python
from aiops_demo.tools.document_importer import DocumentImporter

# åˆå§‹åŒ–
importer = DocumentImporter()

# å¯¼å…¥æ–‡æ¡£ç›®å½•
chunks = importer.load_directory("D:/ä¼ä¸šæ–‡æ¡£", recursive=True)
importer.import_to_milvus(chunks, collection_name="ä¼ä¸šçŸ¥è¯†åº“", drop_old=True)

print("âœ… å¯¼å…¥å®Œæˆï¼")
```

è¿è¡Œï¼š
```bash
python my_import.py
```

---

### æ–¹å¼ Cï¼šè¿è¡Œç¤ºä¾‹

```bash
python examples\import_example.py
```

æŒ‰æç¤ºé€‰æ‹©ç¤ºä¾‹ï¼š
- 1 - å¯¼å…¥ JSON çŸ¥è¯†åº“
- 2 - å¯¼å…¥å•ä¸ªæ–‡æ¡£
- 3 - æ‰¹é‡å¯¼å…¥ç›®å½•
- 4 - è‡ªå®šä¹‰å…ƒæ•°æ®
- 5 - å¢é‡å¯¼å…¥

---

## ğŸ” éªŒè¯å¯¼å…¥ç»“æœ

### æ–¹æ³• 1ï¼šä½¿ç”¨ Milvus æŸ¥çœ‹å·¥å…·

```bash
python aiops_demo\tools\milvus_viewer.py
```

**äº¤äº’å‘½ä»¤ï¼š**
```bash
> list                              # åˆ—å‡ºæ‰€æœ‰ Collections
> info ä¼ä¸šçŸ¥è¯†åº“                   # æŸ¥çœ‹ Collection ä¿¡æ¯
> query ä¼ä¸šçŸ¥è¯†åº“ 10               # æŸ¥çœ‹å‰10æ¡æ•°æ®
> search ä¼ä¸šçŸ¥è¯†åº“ MySQLæ•…éšœ 3    # è¯­ä¹‰æœç´¢
> quit                              # é€€å‡º
```

### æ–¹æ³• 2ï¼šPython ä»£ç éªŒè¯

```python
from pymilvus import connections, Collection

# è¿æ¥
connections.connect(host="192.168.1.65", port="19530")

# æŸ¥çœ‹æ•°é‡
collection = Collection("ä¼ä¸šçŸ¥è¯†åº“")
collection.load()
print(f"æ–‡æ¡£æ•°é‡: {collection.num_entities}")

# æµ‹è¯•æŸ¥è¯¢
results = collection.query(expr="pk >= 0", limit=5, output_fields=["*"])
for r in results:
    print(r)
```

---

## ğŸ“Š å®æˆ˜åœºæ™¯

### åœºæ™¯ 1ï¼šåˆæ¬¡å¯¼å…¥æ‰€æœ‰æ–‡æ¡£

```bash
# 1. å‡†å¤‡æ–‡æ¡£ç›®å½•
D:\ä¼ä¸šæ–‡æ¡£\
â”œâ”€â”€ è¿ç»´æ‰‹å†Œ\
â”‚   â”œâ”€â”€ MySQLè¿ç»´.pdf
â”‚   â”œâ”€â”€ Redisè¿ç»´.pdf
â”‚   â””â”€â”€ Nginxé…ç½®.docx
â”œâ”€â”€ æ•…éšœæ¡ˆä¾‹\
â”‚   â””â”€â”€ 2024æ•…éšœæ±‡æ€».md
â””â”€â”€ SOP\
    â””â”€â”€ åº”æ€¥å“åº”.pdf

# 2. ä¸€é”®å¯¼å…¥
python aiops_demo\tools\document_importer.py \
    --dir "D:\ä¼ä¸šæ–‡æ¡£" \
    --collection "ä¼ä¸šçŸ¥è¯†åº“v1" \
    --drop-old

# 3. éªŒè¯
python aiops_demo\tools\milvus_viewer.py
> info ä¼ä¸šçŸ¥è¯†åº“v1
> search ä¼ä¸šçŸ¥è¯†åº“v1 MySQLè¿æ¥å¤±è´¥ 5
```

### åœºæ™¯ 2ï¼šå¢é‡æ·»åŠ æ–°æ–‡æ¡£

```bash
# æ–°å¢æ–‡æ¡£åï¼Œä¸åˆ é™¤æ—§æ•°æ®
python aiops_demo\tools\document_importer.py \
    --dir "D:\ä¼ä¸šæ–‡æ¡£\æ–°å¢æ–‡æ¡£" \
    --collection "ä¼ä¸šçŸ¥è¯†åº“v1"
    # æ³¨æ„ï¼šä¸åŠ  --drop-old
```

### åœºæ™¯ 3ï¼šæ›´æ–°å·²æœ‰æ–‡æ¡£

```bash
# åˆ é™¤æ—§æ•°æ®ï¼Œé‡æ–°å¯¼å…¥
python aiops_demo\tools\document_importer.py \
    --dir "D:\ä¼ä¸šæ–‡æ¡£" \
    --collection "ä¼ä¸šçŸ¥è¯†åº“v1" \
    --drop-old
```

---

## âš™ï¸ é«˜çº§é…ç½®

### 1. è°ƒæ•´æ–‡æ¡£åˆ‡åˆ†å¤§å°

ç¼–è¾‘ `document_importer.py`ï¼š
```python
self.text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=800,        # æ”¹ä¸º 800ï¼ˆæŠ€æœ¯æ–‡æ¡£å»ºè®® 500-1000ï¼‰
    chunk_overlap=80,      # é‡å æ¯”ä¾‹ 10%
    separators=["\n\n", "\n", "ã€‚", ".", " ", ""]
)
```

### 2. è¿‡æ»¤ç‰¹å®šæ–‡ä»¶ç±»å‹

```python
# åªå¯¼å…¥ PDF
importer.supported_formats = {'.pdf': importer._load_pdf}

# æ·»åŠ æ›´å¤šæ ¼å¼
from langchain_community.document_loaders import CSVLoader
importer.supported_formats['.csv'] = lambda path: CSVLoader(path).load()
```

### 3. è‡ªå®šä¹‰å…ƒæ•°æ®

```python
from langchain_core.documents import Document

documents = [
    Document(
        page_content="æ–‡æ¡£å†…å®¹...",
        metadata={
            "department": "è¿ç»´éƒ¨",
            "category": "æ•…éšœå¤„ç†",
            "priority": "high",
            "tags": ["MySQL", "æ•…éšœ", "è¿æ¥"]
        }
    )
]

importer.import_to_milvus(documents, collection_name="ä¼ä¸šçŸ¥è¯†åº“")
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å¯¼å…¥å¤±è´¥ "Milvus è¿æ¥å¤±è´¥"
**è§£å†³ï¼š**
```bash
# æ£€æŸ¥ Milvus æœåŠ¡çŠ¶æ€
ping 192.168.1.65

# æ£€æŸ¥ç«¯å£
telnet 192.168.1.65 19530

# æ£€æŸ¥é…ç½®
# ç¡®è®¤ config.py ä¸­çš„ host å’Œ port æ­£ç¡®
```

### Q2: å¯¼å…¥å¾ˆæ…¢
**åŸå› ï¼š** å‘é‡åŒ–éœ€è¦è°ƒç”¨ APIï¼Œå¤§é‡æ–‡æ¡£éœ€è¦æ—¶é—´
**è§£å†³ï¼š**
- åˆ†æ‰¹å¯¼å…¥ï¼ˆæ¯æ¬¡ 100-200 ä¸ªæ–‡ä»¶ï¼‰
- ä¼˜åŒ– chunk_sizeï¼ˆå‡å°‘åˆ‡åˆ†å—æ•°é‡ï¼‰
- æ£€æŸ¥ç½‘ç»œé€Ÿåº¦ï¼ˆAPI è°ƒç”¨ï¼‰

### Q3: æŸäº›æ–‡ä»¶å¯¼å…¥å¤±è´¥
**è§£å†³ï¼š**
```python
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
import traceback
try:
    chunks = importer.load_document("é—®é¢˜æ–‡ä»¶.pdf")
except Exception as e:
    traceback.print_exc()
```

å¯èƒ½åŸå› ï¼š
- PDF æ˜¯æ‰«æç‰ˆï¼ˆéœ€ OCRï¼‰
- Word æ–‡ä»¶æŸå
- æ–‡ä»¶ç¼–ç é—®é¢˜ï¼ˆTXTï¼‰

### Q4: å¦‚ä½•åˆ é™¤æŸä¸ª Collectionï¼Ÿ
```bash
python aiops_demo\tools\milvus_viewer.py
> delete ä¼ä¸šçŸ¥è¯†åº“
```

æˆ–è€…ï¼š
```python
from pymilvus import utility, connections
connections.connect(host="192.168.1.65", port="19530")
utility.drop_collection("ä¼ä¸šçŸ¥è¯†åº“")
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… å¯¼å…¥å®Œæˆåï¼Œä¿®æ”¹ `app_simple.py` ä½¿ç”¨æ–°çš„ Collectionï¼š
```python
MILVUS_CONFIG = {
    "collection_name": "ä¼ä¸šçŸ¥è¯†åº“v1"  # æ”¹ä¸ºä½ çš„ Collection åç§°
}
```

2. âœ… é‡å¯åº”ç”¨æµ‹è¯•ï¼š
```bash
python aiops_demo\app_simple.py
# è®¿é—® http://localhost:8888 æµ‹è¯•æ£€ç´¢æ•ˆæœ
```

3. âœ… è°ƒä¼˜å‚æ•°ï¼ˆæ ¹æ®å®é™…æ•ˆæœï¼‰ï¼š
   - `chunk_size`: æ–‡æ¡£åˆ‡åˆ†å¤§å°
   - `top_k`: æ£€ç´¢æ•°é‡
   - Reranker å‚æ•°

4. âœ… éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ–‡æ¡£å¯¼å…¥æŒ‡å—ï¼ˆå®Œæ•´ç‰ˆï¼‰](./æ–‡æ¡£å¯¼å…¥æŒ‡å—.md)
- [Milvus å®˜æ–¹æ–‡æ¡£](https://milvus.io/docs)
- [LangChain æ–‡æ¡£åŠ è½½å™¨](https://python.langchain.com/docs/modules/data_connection/document_loaders/)

---

éœ€è¦å¸®åŠ©ï¼ŸæŸ¥çœ‹é¡¹ç›® README æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚
