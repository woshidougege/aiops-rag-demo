# ä¼ä¸šæ–‡æ¡£å¯¼å…¥å‘é‡æ•°æ®åº“æŒ‡å—

## ğŸ“‹ ç›®å½•
1. [ä¸ºä»€ä¹ˆéœ€è¦å¯¼å…¥å‘é‡æ•°æ®åº“](#ä¸ºä»€ä¹ˆéœ€è¦å¯¼å…¥å‘é‡æ•°æ®åº“)
2. [æ–‡æ¡£å‡†å¤‡](#æ–‡æ¡£å‡†å¤‡)
3. [å¯¼å…¥æ–¹å¼](#å¯¼å…¥æ–¹å¼)
4. [å®æˆ˜ç¤ºä¾‹](#å®æˆ˜ç¤ºä¾‹)
5. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ä¸ºä»€ä¹ˆéœ€è¦å¯¼å…¥å‘é‡æ•°æ®åº“ï¼Ÿ

### âœ… æ˜¯çš„ï¼Œéœ€è¦æŠŠæ–‡æ¡£æ”¾å…¥å‘é‡æ•°æ®åº“

**åŸå› ï¼š**
1. **è¯­ä¹‰æœç´¢**ï¼šä¼ ç»Ÿå…³é”®è¯æœç´¢æ— æ³•ç†è§£åŒä¹‰è¯ã€è¿‘ä¹‰è¯
2. **å¿«é€Ÿæ£€ç´¢**ï¼šå‘é‡æ•°æ®åº“ä½¿ç”¨ ANNï¼ˆè¿‘ä¼¼æœ€è¿‘é‚»ï¼‰ç®—æ³•ï¼Œæ¯«ç§’çº§è¿”å›ç»“æœ
3. **ç›¸ä¼¼åº¦åŒ¹é…**ï¼šèƒ½æ‰¾åˆ°è¯­ä¹‰ç›¸ä¼¼çš„å†…å®¹ï¼Œè€Œä¸ä»…ä»…æ˜¯æ–‡å­—åŒ¹é…

**ä¸éœ€è¦å…¨éƒ¨å¯¼å…¥çš„æƒ…å†µï¼š**
- æ–‡æ¡£å·²ç»è¿‡æ—¶ï¼Œä¸å†ä½¿ç”¨
- æ–‡æ¡£ä¸ä¸šåŠ¡æ— å…³
- æ–‡æ¡£æœ‰ä¸¥æ ¼çš„æƒé™è¦æ±‚ï¼ˆéœ€å•ç‹¬å¤„ç†ï¼‰

---

## æ–‡æ¡£å‡†å¤‡

### 1. æ”¯æŒçš„æ ¼å¼
- âœ… PDF (.pdf)
- âœ… Word (.doc, .docx)
- âœ… Markdown (.md)
- âœ… çº¯æ–‡æœ¬ (.txt)
- âœ… JSON çŸ¥è¯†åº“

### 2. æ–‡æ¡£ç»„ç»‡å»ºè®®

```
ä¼ä¸šæ–‡æ¡£/
â”œâ”€â”€ è¿ç»´æ‰‹å†Œ/
â”‚   â”œâ”€â”€ MySQLè¿ç»´.pdf
â”‚   â”œâ”€â”€ Redisè¿ç»´.pdf
â”‚   â””â”€â”€ æ—¥å¿—åˆ†æ.docx
â”œâ”€â”€ æ•…éšœæ¡ˆä¾‹/
â”‚   â”œâ”€â”€ 2024å¹´æ•…éšœæ±‡æ€».md
â”‚   â””â”€â”€ æ¡ˆä¾‹åº“.json
â””â”€â”€ SOP/
    â”œâ”€â”€ å‘å¸ƒæµç¨‹.md
    â””â”€â”€ åº”æ€¥å“åº”.pdf
```

### 3. æ–‡æ¡£è´¨é‡è¦æ±‚
- âœ… **æ¸…æ™°ç»“æ„**ï¼šæœ‰æ˜ç¡®çš„æ ‡é¢˜ã€ç« èŠ‚
- âœ… **å®Œæ•´å†…å®¹**ï¼šä¸è¦æœ‰æ®‹ç¼º
- âœ… **æ ¼å¼è§„èŒƒ**ï¼šé¿å…æ‰«æç‰ˆ PDFï¼ˆæ–‡å­—è¯†åˆ«ç‡ä½ï¼‰
- âš ï¸ **å»é™¤æ•æ„Ÿä¿¡æ¯**ï¼šå¯†ç ã€IPã€å¯†é’¥ç­‰

---

## å¯¼å…¥æ–¹å¼

### æ–¹å¼ 1ï¼šå‘½ä»¤è¡Œå¯¼å…¥ï¼ˆæ¨èï¼‰

#### a. å•æ–‡ä»¶å¯¼å…¥
```bash
cd d:\aiops-rag-demo
python aiops_demo\tools\document_importer.py --file "æ–‡æ¡£è·¯å¾„.pdf" --collection "ä¼ä¸šçŸ¥è¯†åº“"
```

#### b. æ•´ä¸ªç›®å½•å¯¼å…¥ï¼ˆé€’å½’ï¼‰
```bash
python aiops_demo\tools\document_importer.py --dir "ä¼ä¸šæ–‡æ¡£ç›®å½•" --collection "ä¼ä¸šçŸ¥è¯†åº“"
```

#### c. JSON çŸ¥è¯†åº“å¯¼å…¥
```bash
python aiops_demo\tools\document_importer.py --json "data/knowledge_base.json" --collection "aiops_knowledge_v1"
```

#### d. é‡æ–°å¯¼å…¥ï¼ˆåˆ é™¤æ—§æ•°æ®ï¼‰
```bash
python aiops_demo\tools\document_importer.py --dir "ä¼ä¸šæ–‡æ¡£" --collection "ä¼ä¸šçŸ¥è¯†åº“" --drop-old
```

---

### æ–¹å¼ 2ï¼šPython è„šæœ¬å¯¼å…¥

```python
from aiops_demo.tools.document_importer import DocumentImporter

# åˆå§‹åŒ–å¯¼å…¥å™¨
importer = DocumentImporter()

# æ–¹æ¡ˆ Aï¼šå¯¼å…¥å•ä¸ªæ–‡ä»¶
chunks = importer.load_document("docs/è¿ç»´æ‰‹å†Œ.pdf")
importer.import_to_milvus(chunks, collection_name="ä¼ä¸šçŸ¥è¯†åº“")

# æ–¹æ¡ˆ Bï¼šæ‰¹é‡å¯¼å…¥ç›®å½•
chunks = importer.load_directory("ä¼ä¸šæ–‡æ¡£/", recursive=True)
importer.import_to_milvus(chunks, collection_name="ä¼ä¸šçŸ¥è¯†åº“")

# æ–¹æ¡ˆ Cï¼šä» JSON å¯¼å…¥
importer.import_from_json(
    "data/knowledge_base.json",
    collection_name="æ•…éšœæ¡ˆä¾‹åº“",
    drop_old=True  # åˆ é™¤æ—§æ•°æ®
)
```

---

## å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå¯¼å…¥è¿ç»´æ‰‹å†Œ

å‡è®¾ä½ æœ‰ä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š
```
D:\ä¼ä¸šæ–‡æ¡£\
â”œâ”€â”€ MySQLè¿ç»´æ‰‹å†Œ.pdf
â”œâ”€â”€ Redisæ•…éšœæ’æŸ¥.docx
â””â”€â”€ Nginxé…ç½®æŒ‡å—.md
```

**æ‰§è¡Œå¯¼å…¥ï¼š**
```bash
cd d:\aiops-rag-demo

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœæœ‰ï¼‰
.venv\Scripts\activate

# å¯¼å…¥
python aiops_demo\tools\document_importer.py \
    --dir "D:\ä¼ä¸šæ–‡æ¡£" \
    --collection "è¿ç»´çŸ¥è¯†åº“" \
    --drop-old
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
âœ“ Milvus è¿æ¥æˆåŠŸ: 192.168.1.65:19530
ğŸ“„ åŠ è½½æ–‡æ¡£: D:\ä¼ä¸šæ–‡æ¡£\MySQLè¿ç»´æ‰‹å†Œ.pdf
âœ‚ åˆ‡åˆ†æ–‡æ¡£...
âœ“ åˆ‡åˆ†ä¸º 45 ä¸ªå—
ğŸ“„ åŠ è½½æ–‡æ¡£: D:\ä¼ä¸šæ–‡æ¡£\Redisæ•…éšœæ’æŸ¥.docx
âœ‚ åˆ‡åˆ†æ–‡æ¡£...
âœ“ åˆ‡åˆ†ä¸º 32 ä¸ªå—
...
ğŸ“Š æ€»è®¡åŠ è½½: 123 ä¸ªæ–‡æ¡£å—

ğŸš€ å¼€å§‹å¯¼å…¥åˆ° Milvus Collection: è¿ç»´çŸ¥è¯†åº“
   æ–‡æ¡£æ•°é‡: 123
   åˆ é™¤æ—§æ•°æ®: True
âœ“ å¯¼å…¥å®Œæˆï¼Collection: è¿ç»´çŸ¥è¯†åº“
```

---

### ç¤ºä¾‹ 2ï¼šåˆ›å»ºè‡ªå®šä¹‰å¯¼å…¥è„šæœ¬

```python
# import_company_docs.py
from aiops_demo.tools.document_importer import DocumentImporter

def main():
    importer = DocumentImporter()
    
    # å®šä¹‰è¦å¯¼å…¥çš„æ–‡æ¡£ç›®å½•
    doc_sources = [
        ("D:/ä¼ä¸šæ–‡æ¡£/è¿ç»´æ‰‹å†Œ", "è¿ç»´çŸ¥è¯†åº“"),
        ("D:/ä¼ä¸šæ–‡æ¡£/æ•…éšœæ¡ˆä¾‹", "æ•…éšœæ¡ˆä¾‹åº“"),
        ("D:/ä¼ä¸šæ–‡æ¡£/SOP", "SOPæµç¨‹åº“"),
    ]
    
    for doc_dir, collection_name in doc_sources:
        print(f"\n{'='*60}")
        print(f"ğŸ“‚ å¯¼å…¥ç›®å½•: {doc_dir}")
        print(f"ğŸ“¦ ç›®æ ‡ Collection: {collection_name}")
        print('='*60)
        
        try:
            # åŠ è½½æ–‡æ¡£
            chunks = importer.load_directory(doc_dir, recursive=True)
            
            # å¯¼å…¥ Milvus
            importer.import_to_milvus(
                chunks, 
                collection_name=collection_name,
                drop_old=True  # æ¯æ¬¡é‡æ–°å¯¼å…¥
            )
            
            print(f"âœ… {collection_name} å¯¼å…¥æˆåŠŸï¼\n")
            
        except Exception as e:
            print(f"âŒ {collection_name} å¯¼å…¥å¤±è´¥: {e}\n")

if __name__ == "__main__":
    main()
```

**è¿è¡Œï¼š**
```bash
python import_company_docs.py
```

---

## å…³é”®æŠ€æœ¯ç‚¹

### 1. æ–‡æœ¬åˆ‡åˆ†ï¼ˆChunkingï¼‰

**ä¸ºä»€ä¹ˆè¦åˆ‡åˆ†ï¼Ÿ**
- æ–‡æ¡£å¤ªé•¿ï¼Œå‘é‡æ£€ç´¢æ•ˆæœå·®
- åˆ‡åˆ†åå¯ä»¥ç²¾ç¡®å®šä½åˆ°å…·ä½“æ®µè½

**åˆ‡åˆ†ç­–ç•¥ï¼š**
```python
# åœ¨ document_importer.py ä¸­
self.text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=500,        # æ¯å—500å­—ç¬¦
    chunk_overlap=50,      # é‡å 50å­—ç¬¦ï¼Œä¿æŒä¸Šä¸‹æ–‡
    separators=["\n\n", "\n", "ã€‚", "ï¼", "ï¼Ÿ", ".", "!", "?", " ", ""]
)
```

**è°ƒä¼˜å»ºè®®ï¼š**
- æŠ€æœ¯æ–‡æ¡£ï¼š`chunk_size=500-800`
- é•¿æ–‡æœ¬ï¼š`chunk_size=1000-1500`
- çŸ­é—®ç­”ï¼š`chunk_size=200-400`

### 2. å…ƒæ•°æ®ç®¡ç†

å¯¼å…¥æ—¶ä¼šè‡ªåŠ¨æ·»åŠ å…ƒæ•°æ®ï¼š
```python
metadata = {
    'source_file': 'æ–‡ä»¶å.pdf',
    'file_path': 'å®Œæ•´è·¯å¾„',
    'file_type': '.pdf',
    'error_type': '...',  # JSON å¯¼å…¥æ—¶
    'severity': 'high',   # JSON å¯¼å…¥æ—¶
}
```

åç»­æ£€ç´¢æ—¶å¯ä»¥é€šè¿‡å…ƒæ•°æ®è¿‡æ»¤ï¼š
```python
# åªæ£€ç´¢ PDF æ–‡ä»¶
results = vectorstore.similarity_search(
    query="MySQLæ•…éšœ",
    filter={"file_type": ".pdf"}
)

# åªæ£€ç´¢é«˜ä¼˜å…ˆçº§æ¡ˆä¾‹
results = vectorstore.similarity_search(
    query="ç³»ç»Ÿå´©æºƒ",
    filter={"severity": "high"}
)
```

---

## å¸¸è§é—®é¢˜

### Q1: å¯¼å…¥éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ
**A:** å–å†³äºæ–‡æ¡£æ•°é‡å’Œå¤§å°
- 100ä¸ªå°æ–‡æ¡£ï¼ˆ~10MBï¼‰ï¼šçº¦ 2-5 åˆ†é’Ÿ
- 1000ä¸ªä¸­ç­‰æ–‡æ¡£ï¼ˆ~100MBï¼‰ï¼šçº¦ 20-40 åˆ†é’Ÿ
- ä¸»è¦è€—æ—¶åœ¨**å‘é‡åŒ–**è¿‡ç¨‹ï¼ˆè°ƒç”¨ Embedding APIï¼‰

### Q2: å¯ä»¥å¢é‡å¯¼å…¥å—ï¼Ÿ
**A:** å¯ä»¥ï¼
```bash
# ä¸åŠ  --drop-old å‚æ•°å³å¯å¢é‡å¯¼å…¥
python aiops_demo\tools\document_importer.py --dir "æ–°æ–‡æ¡£" --collection "çŸ¥è¯†åº“"
```

### Q3: å¯¼å…¥åå¦‚ä½•éªŒè¯ï¼Ÿ
**A:** ä½¿ç”¨æŸ¥è¯¢å·¥å…·éªŒè¯ï¼š
```python
from pymilvus import Collection, connections

connections.connect(host="192.168.1.65", port="19530")
collection = Collection("çŸ¥è¯†åº“")
collection.load()

# æŸ¥çœ‹æ•°é‡
print(f"æ–‡æ¡£æ•°é‡: {collection.num_entities}")

# æµ‹è¯•æ£€ç´¢
results = collection.search(
    data=[embeddings.embed_query("MySQLæ•…éšœ")],
    anns_field="vector",
    param={"metric_type": "L2", "params": {"nprobe": 10}},
    limit=3
)
```

### Q4: æ–‡æ¡£æ›´æ–°äº†æ€ä¹ˆåŠï¼Ÿ
**A:** ä¸¤ç§æ–¹æ¡ˆï¼š
1. **å…¨é‡é‡æ–°å¯¼å…¥**ï¼š`--drop-old` åˆ é™¤æ—§æ•°æ®é‡å»º
2. **å¢é‡æ›´æ–°**ï¼šåˆ é™¤æ—§æ–‡æ¡£çš„å—ï¼Œå¯¼å…¥æ–°æ–‡æ¡£

### Q5: å¦‚ä½•å¤„ç†è¶…å¤§æ–‡æ¡£ï¼Ÿ
**A:** å»ºè®®å…ˆæ‰‹åŠ¨åˆ‡åˆ†ï¼š
```python
# å¤§æ–‡æ¡£åˆ‡åˆ†ç¤ºä¾‹
from langchain.text_splitter import RecursiveCharacterTextSplitter

splitter = RecursiveCharacterTextSplitter(
    chunk_size=1000,
    chunk_overlap=100
)

with open("è¶…å¤§æ–‡æ¡£.txt", "r", encoding="utf-8") as f:
    text = f.read()

chunks = splitter.split_text(text)
# åˆ†æ‰¹å¯¼å…¥...
```

---

## ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹ Collection çŠ¶æ€
```python
from pymilvus import Collection, connections

connections.connect(host="192.168.1.65", port="19530")
collection = Collection("çŸ¥è¯†åº“")

print(f"æ–‡æ¡£æ•°é‡: {collection.num_entities}")
print(f"ç´¢å¼•ç±»å‹: {collection.index().params}")
```

### å®šæœŸé‡å»ºç´¢å¼•
```python
# é‡å»ºç´¢å¼•ä»¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
collection.release()
collection.drop_index()
collection.create_index(
    field_name="vector",
    index_params={
        "metric_type": "L2",
        "index_type": "IVF_FLAT",
        "params": {"nlist": 128}
    }
)
collection.load()
```

---

## ä¸‹ä¸€æ­¥

1. âœ… å¯¼å…¥æ–‡æ¡£åˆ° Milvus
2. ğŸ“ ä¿®æ”¹ `app_simple.py` ä½¿ç”¨æ–°çš„ Collection
3. ğŸ§ª æµ‹è¯•æ£€ç´¢æ•ˆæœ
4. ğŸ¯ è°ƒä¼˜å‚æ•°ï¼ˆchunk_size, top_k, ç²¾æ’ç­‰ï¼‰
5. ğŸš€ éƒ¨ç½²ä¸Šçº¿

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒé¡¹ç›® README æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚
